<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Multispecies models: US update</title>
    <meta charset="utf-8" />
    <meta name="author" content="Sarah Gaichas, Andy Beet, Sean Lucey" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/EDAB_theme3_508_SOE_16by9.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: right, middle, my-title, title-slide

# Multispecies models: US update
## WGSAM, 12 October 2020
### Sarah Gaichas, Andy Beet, Sean Lucey

---

class: top, left






background-image: url("EDAB_images/modeling_study.png")
background-size: 380px
background-position: right bottom

# US update for 2020

## Climate - multispecies model projections 
## Ecosystem harveyst control rules 
## Food web model and MSE &lt;a name=cite-lucey_conducting_2020&gt;&lt;/a&gt;([Lucey, Gaichas, and Aydin, 2020](http://www.sciencedirect.com/science/article/pii/S0304380020301290))  

---
## Climate projections with multispecies model


---
## Ecosystem harvest control rules



---
background-image: url("EDAB_images/Balance_concept.png")
background-size: 700px
background-position: right

## Food web: [Rpath](https://github.com/NOAA-EDAB/Rpath) in collaboration with AFSC
.pull-left[ 
Species interactions:
- Full predator-prey: Consumption leads to prey mortality and predator growth
- Static and dynamic model components

Static model: 
For each group, `\(i\)`, specify: 

   Biomass `\(B\)` (or Ecotrophic Efficiency `\(EE\)`)  
   Population growth rate `\(\frac{P}{B}\)`  
   Consumption rate `\(\frac{Q}{B}\)`  
   Diet composition `\(DC\)`  
   Fishery catch `\(C\)`  
   Biomass accumulation `\(BA\)`  
   Im/emigration `\(IM\)` and `\(EM\)`  
   
Solving for `\(EE\)` (or `\(B\)`) for each group:

`$$B_i\Big(\frac{P}{B}\Big)_i*EE_i+IM_i+BA_i=\sum_{j}\Big[ B_j\Big (\frac{Q}{B}\Big)_j*DC_{ij}\Big ]+EM_i+C_i$$`  
]

.pull-right[

]

???
Predation mortality `$$M2_{ij} = \frac{DC_{ij}QB_jB_j}{B_i}$$`

Fishing mortality `$$F_i = \frac{\sum_{g = 1}^n (C_{ig,land} + C_{ig,disc})}{B_i}$$`

Other mortality `$$M0_i = PB_i \left( 1 - EE_i \right)$$`
---
background-image: url("EDAB_images/ForagingArena.png")
background-size: 380px
background-position: right

## Food web: [Rpath](https://github.com/NOAA-EDAB/Rpath) in collaboration with AFSC

.pull-left-70[ 
Dynamic model (with MSE capability):

`$$\frac{dB_i}{dt} = \left(1 - A_i - U_i \right) \sum_{j} Q \left(B_i, B_j \right) -  \sum_{j} Q \left( B_j, B_i \right) - M0_iB_i  - C_m B_i$$`
Consumption: 

`$$Q \left( B_i, B_j \right) = Q_{ij}^* \Bigg( \frac{V_{ij} Ypred_j}{V_{ij} - 1 + \left( 1 - S_{ij} \right) Ypred_j + S_{i} \sum_k \left( \alpha_{kj} Ypred_k \right)} \Bigg) \times \\\Bigg( \frac{D_{ij} Yprey_i^{\theta_{ij}}}{D_{ij} - 1 + \big( \left( 1 - H_{ij} \right) Yprey_i + H_{i} \sum_k \left( \beta_{ik} Yprey_k \right) \big)^{\theta_{ij}}} \Bigg)$$`  
Where `\(V_{ij}\)` is vulnerability, `\(D_{ij}\)` is “handling time” accounting for predator saturation, and `\(Y\)` is relative biomass which may be modified by a foraging time multiplier `\(Ftime\)`,

`$$Y[pred|prey]_j =  Ftime_j \frac {B_j}{B_j^*}$$`

]

.pull-right-30[

]
???
The parameters `\(S_{ij}\)` and `\(H_{ij}\)` are flags that control whether the predator density dependence `\(S_{ij}\)` or prey density dependence `\(H_{ij}\)` are affected solely by the biomass levels of the particular predator and prey, or whether a suite of other species’ biomasses in similar roles impact the relationship. 

For the default value for `\(S_{ij}\)` of 0 (off), the predator density dependence is only a function of that predator biomass and likewise for prey with the default value of 0 for `\(H_{ij}\)`.  

Values greater than 0 allow for a density-dependent effects to be affected by a weighted sum across all species for predators, and for prey.  The weights `\(\alpha_{kj}\)` and `\(\beta_{kj}\)` are normalized such that the sum for each functional response (i.e. `\(\sum_k\alpha_{kj}\)` and `\(\sum_k\beta_{kj}\)` for the functional response between predator *j* and prey *i*) sum to 1.  The weights are calculated from the density-independent search rates for each predator/prey pair, which is equal to `\(2Q_{ij}^*V_{ij} / (V_{ij} - 1)B_i^*B_j^*\)`.  


---
background-image: url("EDAB_images/herrup10pann.png")
background-size: 830px
background-position: right bottom

## Epilogue: Herring MSE food web modeling supplemental results

- Tradeoffs between forage groups and mixed impacts to predators apparent when multiple species and full predator prey interaction feedbacks can be included

.pull-left-30[
- Rpath Ecosense functions evaluate parameter uncertainty within a scenario

- Now we have MSE closed loop possibilities in Rpath!

- Can implement HCRs with predator prey interactions (Lucey et al. accepted)

]
.pull-right-70[

]
---
## References
.contrib[
&lt;a name=bib-lucey_conducting_2020&gt;&lt;/a&gt;[Lucey, S. M, S. K. Gaichas, and
K. Y. Aydin](#cite-lucey_conducting_2020) (2020). "Conducting
reproducible ecosystem modeling using the open source mass balance
model Rpath". En. In: _Ecological Modelling_ 427, p. 109057. ISSN:
0304-3800. DOI:
[10.1016/j.ecolmodel.2020.109057](https://doi.org/10.1016%2Fj.ecolmodel.2020.109057).
URL:
[http://www.sciencedirect.com/science/article/pii/S0304380020301290](http://www.sciencedirect.com/science/article/pii/S0304380020301290)
(visited on Apr. 27, 2020).
]

## Additional resources


.footnote[
Slides available at https://noaa-edab.github.io/presentations  
Contact: &lt;Sarah.Gaichas@noaa.gov&gt;
]

---
---
## Multispecies catch at age estimation model: *seeking catchy name* [FIT: MSCAA](https://nmfs-ecosystem-tools.github.io/MSCAA/)

Species interactions: 
- Predation: Top down only (predators increase M of prey, predators grow regardless of prey)

*Based on standard age structured stock assessment population dynamics equations*
- First, split `\(M\)` for species `\(i\)` age `\(a\)` into components: `$$M_{i,a,t} = M1_i + M2_{i,a,t}$$`  
- Calculate `\(M2\)` with MSVPA predation equation, which applies a predator consumption:biomass ratio to the suitable prey biomass for that predator. 
- Suitability is a function of predator size preference (based on an age-specific predator:prey weight ratio) and prey vulnerability (everything about the prey that isn't size related). 
- Also sensitive to "other food"

`$$M2_{i,a,t} = \frac{1}{N_{i,a,t}W_{i,a,t}}\sum_j \sum_b CB_{j,b} B_{j,b,t} \frac{\phi_{i,a,j,b,t}}{\phi_{j,b,t}}$$`
???

Size preference is `$$g_{i,a,j,b,t}=\exp\bigg[\frac{-1}{2\sigma_{i,j}^2}\bigg(\ln\frac{W_{j,b,t}}{W_{i,a,t}}-\eta_{i,j}\bigg)^2\bigg]$$`

Suitability, `\(\nu\)` of prey `\(i\)` to predator `\(j\)`:
`$$\nu_{i,a,j,b,t}=\rho_{i,j}g_{i,a,j,b,t}$$`

Scaled suitability: 
`$$\tilde\nu_{i,a,j,b,t}=\frac{\nu_{i,a,j,b,t}}{\sum_i \sum_a \nu_{i,a,j,b,t} + \nu_{other}}$$`

Suitable biomass of prey `\(i\)` to predator `\(j\)`:
`$$\phi_{i,a,j,b,t}=\tilde\nu_{i,a,j,b,t}B_{i,a,t}$$`

Available biomass of other food, where `\(B_other\)` is system biomass minus modeled species biomass:
`$$\phi_{other}=\tilde\nu_{other}B_{other,t}$$`
Total available prey biomass:
`$$\phi_{j,b,t}=\phi_{other} + \sum_i \sum_a \phi_{i,a,j,b,t}$$`
---
## Multispecies catch at length simulation model: [Hydra](https://github.com/NOAA-EDAB/hydra_sim)

Species interactions: 
- Predation: Top down only (predators increase M of prey, predators grow regardless of prey)  

*Same MSVPA predation equation as MSCAA (but length based), same dependencies and caveats*

- Suitability, `\(\rho\)`, of prey species `\(m\)` size `\(n\)` for a given predator species `\(i\)` size `\(j\)` a function of size preference and vulnerability  {0,1}. 
- Food intake `\(I\)` for each predator-at-size is temperature dependent consumption rate times mean stomach content weight. 

`$$M2_{m,n,t} = \sum_i \sum_j I_{i,j,t} N_{i,j,t} \frac{\rho_{i,j,m,n}}{\sum_a \sum_b \rho_{i,j,a,b} W_{a,b} N_{a,b} + \Omega}$$`

*Associated GitHub repositories*
* [hydra-sim Wiki](https://github.com/NOAA-EDAB/hydra_sim/wiki)
* [hydradata](https://github.com/NOAA-EDAB/hydradata)
* [LeMANS](https://github.com/NOAA-EDAB/LeMANS)
* [hydra-est](https://github.com/NOAA-EDAB/hydra_est) Work in progress to convert to estimation model
* [mscatch](https://github.com/NOAA-EDAB/mscatch) Multispecies fishery catch data

???
But:
- Covariates on growth, maturity, recruitment possible; intended for environmental variables
- So could hack in prey-dependent growth but making it dynamic is difficult

We specify 'preferred' predator-prey weight ratio (log scale) `\(\Psi_j\)` and variance in predator size preference `\(\sigma_j\)` to compare with the actual predator-prey weight ratio `\((w_n / w_j)\)` to get the size preference `\(\vartheta\)`. 

`$$\vartheta_{n,j} = \frac{1}{(w_n / w_j)\sigma_j \sqrt{2\pi}} e^{-\frac{[log_e(w_n / w_j) - \Psi_j]}{2\sigma_j^2}}$$`

Food intake is `$$I_{i,j,t} = 24 [\delta_j e^{\omega_i T}]\bar{C}_{i,j,k,t}$$`


---
## Hydra: details and current uses
.pull-left[
*2018 CIE for Ecosystem Based Fishery Management Strategy* 
* [EBFM strategy review](https://www.nefsc.noaa.gov/program_review/)
* Multispecies model simulations
&lt;img src="EDAB_images/EBFM HCR.png" width="75%" /&gt;

]
.pull-right[
![hydrascenarios](EDAB_images/xradarScenario41-50yrs.png)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="libs/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "githubp",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
