---
title: "State of the Ecosystem:"
subtitle: "Reporting on Northeast Continental Shelf<br> ecosystem status and trends."
author: "Sean Hardison<br /> Ecosystem Dynamics and Assessment <br /> Integrated Statistics and Northeast Fisheries Science Center"
output:
  xaringan::moon_reader:
    css: ["default", "libs/20190313_EBFMseminar_Hardison_theme.css"]
    lib_dir: libs
    nature:
      titleSlideClass: ["right", "middle", "my-title"]
      highlightStyle: githubp
      highlightLines: true
      countIncrementalSlides: false
  revealjs::revealjs_presentation:
    self_contained: false
    reveal_plugins: ["notes", "search"]
---
class: top, left

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = F,
                      warning = F,
                      message = F)
#Plotting and data libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(ecodata)
library(here)
library(kableExtra)
library(ggrepel)
library(stringr)
library(patchwork)
library(grid)
library(plotly)
library(vegan)
library(rpart)
library(colorRamps)

#GIS libraries
library(sf)
library(rgdal)
library(raster)
library(rnaturalearth)

data.dir <- here::here("data")


#Time series constants
shade.alpha <- 0.3
shade.fill <- "lightgrey"
lwd <- 1
pcex <- 2
trend.alpha <- 0.5
trend.size <- 2
hline.size <- 1
hline.alpha <- 0.35
hline.lty <- "dashed"
label.size <- 5
hjust.label <- 1.5
letter_size <- 4
feeding.guilds <- c("Apex Predator","Piscivore","Planktivore","Benthivore","Benthos")
x.shade.min <- 2009
x.shade.max <- 2018
map.lwd <- 0.4
#Function for custom ggplot facet labels
label <- function(variable,value){
  return(facet_names[value])
}

#facet names for titles
facet_names <- list("Apex predators" = expression("Apex predators"),
                    "Piscivores" = expression("Piscivores"),
                    "Planktivores" = expression("Planktivores"),
                    "Benthivores" = expression("Benthivores"),
                    "Benthos" = expression("Benthos"))
#CRS
crs <- "+proj=longlat +lat_1=35 +lat_2=45 +lat_0=40 +lon_0=-77 +x_0=0 +y_0=0 +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"

#Coastline shapefile
coast <- ne_countries(scale = 10,
                          continent = "North America",
                          returnclass = "sf") %>%
             sf::st_transform(crs = crs)

#State polygons
ne_states <- ne_states(country = "united states of america",
                                      returnclass = "sf") %>%
  sf::st_transform(crs = crs)

#high-res polygon of Maine
#new_england <- read_sf(gis.dir,"new_england")

#EPU shapefile
epu_sf <- ecodata::epu_sf %>% 
  filter(EPU %in% c("MAB","GB","GOM"))
```

# Today's seminar

.pull-left[

- Ecosystem Reporting and why it matters

- Functional role of ecosystem reporting in the Northeast US

- Report structure

- Results from the 2019 Mid-Atlantic and New England reports

- Strategies for open-source reporting
]

.pull-right[
*The IEA Loop<sup>1</sup>*
![iea-loop](20190313_EBFMseminar_Hardison_images/iea-loop.png)


]

.footnote[
[1] https://www.integratedecosystemassessment.noaa.gov/national/IEA-approach
]

???


---

## Ecosystem-Based Management

.pull-left[
* Place-based management of all human ecosystem uses, or **sectors**<sup>1</sup>

  * "Cross-sectoral" 
  
  * Scale of "place" defined by scale of impacts

]

.pull-right[

```{r ebm-sectors, fig.align="center", out.width = "100%", echo = F}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/ebm-sectors.png")
```

]


.footnote[
[1] Agardy, Tundi, et al. "Taking steps toward marine and coastal ecosystem-based management: An introductory guide." (2011).


[2] Patrick, Wesley S., and Jason S. Link. "Myths that continue to impede progress in ecosystem-based fisheries management." Fisheries 40.4 (2015): 155-160.
]

## Ecosystem-Based Fishery Management

* Integrated management of a **single-sector** (i.e. fisheries)
* Considers trade-offs of management strategies on ecosystem components<sup>2</sup>



```{r ebfm-single-sector, fig.align="center", out.width = "50%", echo = F}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/ebfm-single-sector.png")
```

???
Under EBM, the idea is that these "sectors" must be managed in an integrated fashion, where impacts of each sector on the ecosystem can be assessed and managed with respect to objectives

Ecosystem-based fishery management, or EBFM, is integrated management of a single sector, that is, fisheries.

EBFM considers trade-offs of management strategies on ecosystem components, within the fisheries sector

---
## Ecosystem Components

```{r nes-comp1, echo = F}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/nes-components.png")
```

???
Here we describe the relationships between major ecosystem components on the northeast shelft


---
# Integrated Ecosystem Assessment (IEA)

**A framework for synthesis and analysis of natural, social, and economic factors that are relevant to established ecosystem management objectives<sup>1</sup>**

.pull-right[
.footnote[
[1] Levin, Phillip S., et al. "Integrated ecosystem assessments: developing the scientific basis for ecosystem-based management of the ocean." PLoS biology 7.1 (2009): e1000014.

]
]
--

![iea-loop-explanations](20190313_EBFMseminar_Hardison_images/iea-loop-explanation.png)
*The IEA Loop*

???
Before jumping in I'm going to start with some definitions of terms that you'll be hearing a lot of. The first is Integrated Ecosystem Assessmentor (IEA).

IEA is defined as a framework for the synthesis and analysis of relevant natural, social, and economic factors that are relevant to established management objectives.

IEA has been embraced on a nationwide scale by NOAA fisheries, and is a method for moving towards Ecosystem-Based Management for natural resources. 

It's an iterative process, hence, "the loop", and starts with the establishment of management goals by fishery management councils. 

Once objectives are defined, we develop indicators that allow us to quantify and report on the status and trends of ecosystem processes. 

Next we work with management bodies to identify sources of risk in ecosystems that threaten the achievement of management goals, and then we use modeling techniques to evaluate how certain management strategies could propagate through the system. 

Today I'm going to be talking to you about the ecosystem reporting phase of this process. 

---

## Ecosystem Status Reporting (ESR)

Ecosystem reporting provides a route for ecosystem information to enter the stock assessment process

* Well-developed example is AFSC; whose ESRs have long served as context for North Pacific FMC quota 
deliberations<sup>1</sup>

All IEA regions in the US develop similar documents in varying guises


.footnote[
[1] Zador, Stephani G., et al. "Ecosystem considerations in Alaska: the value of qualitative assessments." ICES Journal of Marine Science 74.1 (2017): 421-430.
]

--

.pull-left[
*IEA Regions*
```{r iea-regions, out.width = "100%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/iea-regions.png")
```

]

.pull-right[
*Ecosystem Status Reports*
```{r esr-breakdown, out.width = "100%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/esr-breakdown.png")
```
]

???

---

## Goals of ESR:

* Identify changes in ecosystem component status (short-term) and trend (long-term)

* Identify potential for changes to affect management concerns

* Highlight "red flags" and potential ecosystem state changes

![SOE-Network-Diagram](20190313_EBFMseminar_Hardison_images/SOE_Network_Diagram.png)

???
This network diagram provides an example of how primary production and environmental drivers are linked to a pelagic fishery and protected species.  

With ESRs, we want to describe these linkages and explain why they're important to managers. 

Nested within the pelagic fishery node in this diagram are the societal benefits derived from that fishery, linking social and economic ecosystem components to the base of the food web and environment.

---

## ESRs in the Northeast US: Relevance to management

**Why should managers care about an ecosystem perspective to resource management?**

--

Well-informed management decisions rely upon knowledge of the ecosystem being managed

--

An ecosystem perspective is important for managing in the face of rapid, unprecedented ecosystem changes

.pull-left[

```{r long-term sst, echo = F, fig.height=4}

lt_sst <- ecodata::long_term_sst %>% 
  mutate(hline = mean(Value))

lt_sst %>% 
  ggplot(aes(x = Time, y = Value, group = Var)) +
         annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_gls() +
  geom_line() +
  geom_point() +
  ylab("Temperature (°C)") +
  # ggtitle("") +
    scale_x_continuous(expand = c(0.01, 0.01), breaks = seq(1840,2010,20))+
      geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_facet() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"),
        axis.title = element_text(size = 14))

```
*NE Shelf Long-term SST*
]

.pull-right[
```{r GSI, fig.height = 4, echo = F}
gsi %>% 
  mutate(Year = floor(Time)) %>% 
  group_by(Year) %>% 
  dplyr::summarise(Value = mean(Value)) %>% 
  mutate(hline = mean(Value)) %>% 
  dplyr::rename(Time = Year) %>% 
  ggplot(aes(x = Time, y = Value)) +
         annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_gls() +
  geom_line() +
  geom_point() +
  ylab("Gulf Stream position anomaly") +
  # ggtitle("") +
    scale_x_continuous(expand = c(0.01, 0.01))+
      geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_ts() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"),
        axis.title = element_text(size = 14))
```
*Gulf Stream Index*
]

???
SST
Figure on left shows estimated time series of SST extending back to to 1850s. 
*7 out of 10 of the hottest years have been in the past decade

GSI
The figure on the right shows that deviation from the mean latitude of the north wall of the gulf stream, showing anomalously high value for the past 5 years

These things are important for managers to know about because they directly influence stock distribution dynamics

---

## ESRs in the Northeast US: Relevance to management

Fisheries yields are affected by ecosystem conditions<sup>1-3</sup>

Important ecosystem predictors of fisheries yield on global scale<sup>1</sup>:
* Sea surface temperature (-)
* Chlorophyll <i>a</i> (+)
* Particle export ratio (particles leaving euphotic zone:primary production) (+)
* Mesozooplankton productivity (+)

```{r chl-yield, echo = F, out.width = "50%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/chl-yield.png")
```


.pull-right[
.footnote[
[1] Friedland, Kevin D., et al. "Pathways between primary production and fisheries yields of large marine ecosystems." PLoS One 7.1 (2012): e28945.

[2] Frank, Kenneth T., et al. "Reconciling differences in trophic control in mid‐latitude marine ecosystems." Ecology Letters 9.10 (2006): 1096-1105.

[3] Ware, Daniel M., and Richard E. Thomson. "Bottom-up ecosystem trophic dynamics determine fish production in the Northeast Pacific." science 308.5726 (2005): 1280-1284.
]
]

???
The figure here shows the relationship between chlorophyll a production in 52 large marine ecosystems around the world with fisheries yield in those systems.

So we know that these relationships exist, but drawing actionable place-based management advice from this information is difficult, but in the works here at the Center.


---

## ESR in the Northeast US

ESRs developed by NEFSC since 2009

Considerable support for EAFM exists in Northeast
* Most FMC members in the Northeast support transitioning from a single-species to a multi-species ecosystem approach (i.e. EBFM) to management<sup>1</sup>

--

Common refrain upon recieving ESR:
# "So what"?


.footnote[
Biedron, Ingrid S., and Barbara A. Knuth. "Toward shared understandings of ecosystem-based fisheries management among fishery management councils and stakeholders in the US Mid-Atlantic and New England regions." Marine Policy 70 (2016): 40-48.
]

---

## Problems with ESR model:

* Council members are busy people!

  * Long-documents with unfamiliar information unlikely to connect
  
* Not all Council members have science background

* "What does chlorophyll concentration tell us about fisheries yields?"

The disconnect inspired a new model, which we call **State of the Ecosystem (SOE)** reports

```{r soe-snippet,out.width = "100%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/soe-snippet.png")
```


???
Question - We can't answer that question directly, but we can do a better job describing these ecosystem pathways 

---

## SOE Reporting: Ecosystem science for busy people

Addressing critiques to ESR model in SOE

1. Clear alignment of ecosystem components with management objectives

1. Objectives related to human-well being placed first in report

1. Non-technical text

1. Short (< 30 pages), but rigorous

1. Emphasis on reproducibility 

```{r nes-comp2, echo = F, out.width = "60%", fig.align = "center"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/nes-components-abstracted.png")
```

???
In 2016, we began taking steps to address these common critiques of the ESR model


---
## SOE reporting: Quantifying change

Status (short-term) and trend (long-term) of components are measured as **indicators**

Indicators are selected to

1. Be broadly informative about a component in a management context<sup>1-3</sup>

1. Minimize redundancy of information

1. Be responsive to ecosystem change

--

```{r doc-orientation, echo = F, warning = F, message=F, fig.height = 3, fig.width=8, fig.align = "center"}
m <- 0.1
x <- 1989:2018
y <-  m*x + rnorm(30, sd = 0.35)

data <- data.frame(x = x,
                  y = y)

#Define constants for figure plot
x.shade.max <- max(x)
x.shade.min <- x.shade.max - 9 
hline = mean(y)

#Plot series with trend 
ggplot2::ggplot(data = data,aes(x = x, y = y)) +
  #Highlight last ten years
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_point(size = pcex) +
  scale_color_manual(aesthetics = "color")+
  guides(color = FALSE) +
  geom_hline(aes(yintercept = hline),
              size = hline.size,
             alpha = hline.alpha,
             linetype = hline.lty)+
  geom_line() +
  geom_gls() +
  scale_y_continuous(labels = function(l){trans = l / 1000})+
  scale_x_continuous(breaks = seq(1985, 2015, by = 5), expand = c(0.01, 0.01)) +
  ylab(expression("Invented Index, 10"^3*"widgets")) +
  xlab("Year") +
  ggtitle("Indicator Z") +
  theme_ts() +
  theme(plot.title = element_text(size = 16),
        axis.title = element_text(size = 14))
```



.footnote[
[1] Rice J. C.Rochet M. J. "A framework for selecting a suite of indicators for fisheries management." ICES Journal of Marine Science 62 (2005): 516–527.

[2] Link J. 2010. Ecosystem-Based Fisheries Management: Confronting Tradeoffs . Cambridge University Press, New York.

[3] Zador, Stephani G., et al. "Ecosystem considerations in Alaska: the value of qualitative assessments." ICES Journal of Marine Science 74.1 (2017): 421-430.
]


---
## SOE reporting: Indicator spatial scales


![epus](20190313_EBFMseminar_Hardison_images/epu-layout-soe-regions.png)

.footnote[
https://noaa-edab.github.io/tech-memo/epu.html
]

???
Indicators 

---
## State of the Ecosystem 2019: Structure
.pull-left[

### Report Structure
1. Human dimensions

2. Protected species

3. Fish and invertebrates (managed and otherwise)

4. Habitat quality and ecosystem productivity
]

.pull-right[
.table[
<table class="table" style="width: 50; margin-left: auto; margin-right: auto;">
<caption>Ecosystem-scale objectives and indicators on the Northeast US shelf</caption>
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;"> Objective Categories </th>
   <th style="text-align:left;font-weight: bold;"> Indicators </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Seafood Production </td>
   <td style="text-align:left;"> Landings by feeding guild </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Profits </td>
   <td style="text-align:left;"> Revenue by feeding guild </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Recreation </td>
   <td style="text-align:left;"> Number of anglers and trips; recreational catch </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Stability </td>
   <td style="text-align:left;"> Diversity indices (fishery and species) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Social &amp; Cultural </td>
   <td style="text-align:left;"> Commercial and recreational reliance </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Biomass </td>
   <td style="text-align:left;"> Biomass or abundance by feeding guild from surveys </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Productivity </td>
   <td style="text-align:left;"> Condition and recruitment of managed species </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Trophic structure </td>
   <td style="text-align:left;"> Relative biomass of feeding guilds, primary productivity </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Habitat </td>
   <td style="text-align:left;"> Estuarine and offshore habitat conditions </td>
  </tr>
</tbody>
</table>
]
]
---
## SOE 2019: Feeding guilds

```{r guilds}
df <- data.frame("Feeding guild" = c("Apex Predator","Piscivore","Planktivore","Benthivore","Benthos"),
                 Description = c("Top of food chain","Fish eaters","Zooplankton eaters",
                                 "Feed on bottom","Things that live on bottom"),
                 Examples = c("Shark spp, swordfish","Atlantic cod, spiny dogfish","Atlantic herring","Lobster, black sea bass","Sea scallop, urchins"))

knitr::kable(df) %>% 
kable_styling(bootstrap_options = c("striped", "hover")) 
```

* Feeding guilds assigned based on NEFSC food habits data base
  * Food habits change with age and size, so guilds assigned based on most common size class

* Simplified from existing guild structures<sup>1,2</sup>

.footnote[
[1] Garrison, Lance P, and Jason S Link. 2000. “Dietary guild structure of the fish community in the Northeast United States continental shelf ecosystem.” Marine Ecology Progress Series 202:231–40.

[2] Link, Jason S, Carolyn A Griswold, Elizabeth T Methratta, and Jessie Gunnard. 2006. Documentation for the energy modeling and analysis exercise (EMAX). US Department of Commerce, National Oceanic; Atmospheric Administration.
]

???
Because we focus on ecosystem context, we've aggregated species in most of our indicators up to the level of feeding guild, shown here.

These feeding guilds were derived from NEFSC food habits data and existing guilds identified in the literature

---
## SOE 2019: Human dimensions 
**Commercial fisheries: Total landings**
.pull-left[
NE:
* Significant decreases in NEFMC managed species in Gulf of Maine

* Periodic signal in GB/MAB Benthos landings reflects rotational management of scallops
]

.pull-right[
```{r ne-total-landings, out.width = "100%"}
source("R/total_landings_plot.R")

gom_total <- plot_total_landings(epu = "GOM", council = "NEFMC")
gb_total <- plot_total_landings(epu = "GB", council = "NEFMC")


gom_total + gb_total + plot_layout(ncol = 1)
```
]

---
## SOE 2019: Human dimensions 
**Commercial fisheries: Landings by feeding guild**
* Decrease in Atlantic herring driving divergence between managed/non-managed species

```{r feeding-guild-landings, out.width = "60%", fig.align="center"}

source("R/feeding_guild_landings_plot.R")

gom_feeding_guild <- feeding_guild_landings(epu = "GOM", "NEFMC")
gb_feeding_guild <- feeding_guild_landings(epu = "GB", "NEFMC")

gom_feeding_guild + gb_feeding_guild + plot_layout(ncol = 2)

```

---
## SOE 2019: Human dimensions
**Commercial fisheries: Landings by feeding guild**
```{r planktivores-gom, fig.width = 7.25, fig.height = 3.5, fig.align = "center"}
feeding_guild_landings(epu = "GOM", "NEFMC", filt = T)
```


---
## SOE 2019: Human dimensions 
**Commercial fisheries: Total landings**

.pull-left[
MAB:
* Total managed and non-managed landings in MAB are declining, playing out as declines in most feeding guild landings

* Increase in benthivore landings (scup, black sea bass, tilefish)

* Total revenue of managed species also shows negative trend

```{r total-landings2, fig.height = 3}
mab_total <- plot_total_landings(epu = "MAB", council = "MAFMC")

mab_total
```

]

.pull-right[
```{r total-landings3, fig.height = 9}
mab_feeding_guild <- feeding_guild_landings(epu = "MAB", "MAFMC")

mab_feeding_guild 
```

]
---
## SOE 2019: Human dimensions
**Community engagement and reliance on commercial fisheries**

NE:
* High social-ecological reliance on scallop and lobster
* Species considered moderately to highly at risk due to climate change (OA, temp)


```{r com-eng1, fig.width = 8, fig.height = 5, fig.align="center"}
source("R/engagement_plots.R")
engagement_plots(type = "comm",epu = "GOM")
```

???
Many social-ecological systems in New England are reliant on lobster, as in Gulf of Maine, or scallop, for Georges Bank. As these species are considered moderately to highly at risk due to climate change, the communities dependent on them are at risk as well. 

---
## SOE 2019: Human dimensions
**Community engagement and reliance on commercial fisheries**
.pull-left[
MAB: 

* Similar story in MAB, where there is heavy reliance on scallops

* Aquaculture in the MAB is also dominated by shellfish (oysters)

]
.pull-right[
```{r oyster-aqua, fig.height = 9}

aqua <- ecodata::aquaculture %>% 
  group_by(Var) %>% 
  mutate(hline = mean(Value)) %>%
  ungroup() %>% 
  mutate(Var = plyr::mapvalues(Var, from = c("md oyster harvest","nj oyster harvest","va oyster harvest"),
                                                    to  = c("MD","NJ","VA"))) %>%
  dplyr::rename(State = Var)

aqua$State <- factor(aqua$State, levels = c("VA","MD","NJ"))


aqua_plot <- ggplot() + 
  geom_segment(aes(x=2005,xend=2017,y=mean(aquaculture[aquaculture$Var == "va oyster harvest",]$Value),
                   yend=mean(aquaculture[aquaculture$Var == "va oyster harvest",]$Value)),
               size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty,
           color = "#1b9e77",
           inherit.aes = F) +
  geom_segment(aes(x=2012,xend=2016,y=mean(aquaculture[aquaculture$Var == "nj oyster harvest",]$Value),
                   yend=mean(aquaculture[aquaculture$Var == "nj oyster harvest",]$Value)),
               size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty,
           color = "#d95f02",
           inherit.aes = F) +
  geom_segment(aes(x=2012,xend=2017,y=mean(aquaculture[aquaculture$Var == "md oyster harvest",]$Value),
                   yend=mean(aquaculture[aquaculture$Var == "md oyster harvest",]$Value)),
               size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty,
           color = "#7570b3",
           inherit.aes = F) +
 #Highlight last ten years
  geom_line(data = aqua, aes(x = Time, y = Value, color = State), size = lwd) +
  geom_point(data = aqua,aes(x = Time, y = Value, color = State), size = pcex) +
  scale_color_manual(values = c(VA = "#1b9e77", MD = "#7570b3",NJ = "#d95f02")) +
  scale_x_continuous(breaks = seq(2005,2018,3),expand = c(0.01, 0.01)) +
  scale_y_continuous(labels = function(l){trans = l / 1000000})+
  ggtitle("MAB oyster harvest")+
  ylab(expression("Oysters sold (10"^6*" n)")) +
  xlab("")+
  theme_ts()+
    theme(axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold"))

comm_plot <- engagement_plots(type = "comm",epu = "MAB")

aqua_plot + comm_plot + plot_layout(ncol = 1, heights = c(1, 3))
```
]

???
Virginia continues to lead the country in oyster production, with aquaculture in the region growing quickly. The time series looks flat compared to Virginia, but oyster aquaculture in New Jersey is also growing.


---
## SOE 2019: Human dimensions
**Recreational fishing**
.pull-left[
NE: 
* Positive long-term trend for diversity of catch in New England recreational fisheries

* Overall decline in rec seafood harvest since 1980s
  * Trending upwards since mid-90s

* Increase in recreational effort (n anglers) since the mid 90s
]
.pull-right[
```{r rec-div1, fig.height=9}
source("R/rec_div_plots.R")
source("R/rec_harvest_plots.R")
source("R/rec_effort_plots.R")
ne_rec_div <- rec_div_plots("NE")
ne_rec_harvest <- rec_harvest_plots("NE")
ne_rec_effort <- rec_effort_plots("NE")

ne_rec_div[[2]] + ne_rec_harvest + ne_rec_effort[[2]] + plot_layout(ncol = 1)
```
]

???
While commercial fisheries have high specialization of catch, there's a positive long-term trend for recreational catch diversity in the recreational sector. 

Updated Marine Recreational Information Program data shows that there's been an upswing in harvest since the mid-90s, although the trend overall is negative

This corresponds with an increase in recreational effort since the mid-90s

---
## SOE 2019: Human dimensions
**Recreational fishing**
.pull-left[
MAB: 
* Similar to NE, there's been a slight increase in rec seafood harvest and recreational effort

* An opposite trend in recreational fleet effort diversity and diversity of catch
  * Decline in fleet effort diversity due to fewer party boats (24% of all trips down to 6%)

]
.pull-right[
```{r rec-div2, fig.height=9}
ma_rec_div <- rec_div_plots("MA")
ma_rec_harvest <- rec_harvest_plots("MA")
ma_rec_effort <- rec_effort_plots("MA")
(ma_rec_harvest | ma_rec_effort[[2]]) /
  ma_rec_div[[1]] /
  ma_rec_div[[2]]
```
]

???
Similar to NE, there's been a slight increase in recreational catch since the 90s in the Mid-Atlantic, along with a general increase in effort.

However, different from NE, there are significant downward trends in fleet effort diversity and diversity of catch. While a decline in fleet effort diversity is due to fewer party boats, we can't be sure why there's been a decline in diversity of catch, as South Atlantic FMC species are not tracked seperately.

---
## SOE 2019: Human dimensions
**Recreational engagement and reliance**

.pull-left[
* Downward trend in recreational catch diversity may threaten fishing community stability in Mid-Atlantic

* Engaged and reliant communities in New England could benefit from higher diversity of catch
]

.pull-right[
```{r rec-engagement, fig.height = 9}
source("R/engagement_plots.R")
shelf_rel <- engagement_plots(type = "rec",epu = "shelf", make_sparse = T)

shelf_rel
```
]
---
## SOE 2019: Protected species

* Protected species include marine mammals, endangered and threatened species, and migratory birds

```{r narw-photo, fig.align="center", out.width = "70%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/narw-credit-beth-josephson.JPG")
```
.image-cap[
*Image credit: Beth Josephson, NOAA Fisheries*
]
--

* **Fishery management objectives** focus on reducing threats to protected species and conserving habitat

???
* in 2018, there were 4 unusual mortality events for three large whale species and two seal species
--



---
## SOE 2019: Protected species
**North Atlantic right whales (NARW)**
* Strong consensus of population decline

  * Diverging abundance trends between sexes, with higher female mortality rates
--

* Evidence suggests that the level of interaction between NARWs, lobster gear (US), and snow crab gear (CAN) is contributing to the decline of the species

  * 20 NARW deaths in 2017 and 2018, >50% due to human interactions (5 vessel strike, 6 entanglement)

```{r NARW-abundance, fig.width = 7.25, fig.height = 3.5, fig.align = "center"}
hline <- mean(narw[narw$Var == "right whale abundance median",]$Value)
series.col <- "black"
ecodata::narw %>% 
  spread(.,Var,Value) %>% 
  ggplot() +
#Highlight last ten years
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line(aes(x = Time, y = `right whale abundance median`), size = lwd-0.75) +
  geom_point(aes(x = Time, y = `right whale abundance median`), size = pcex-0.75) +
  geom_errorbar(aes(x = Time,
                    ymin = `right whale abundance lcl`,
                  ymax = `right whale abundance ucl`), 
                width = 0.25) +
  scale_x_continuous(expand = c(0.01, 0.01)) +
  scale_color_manual(values = series.col, aesthetics = "color")+
  guides(color = FALSE) +
  ggtitle("NARW abundance") +
  ylab(expression("Abundance (n)")) +
  xlab("Time")+
  geom_hline(aes(yintercept = hline),
           color = "black",
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  theme_ts() + 
  theme(axis.title = element_text(size = 14),
        plot.title = element_text(size = 16, face = "bold"))
```

???
The North Atlantic right whale is among the most endangered whales in the world, with less than 450 individuals remaining and declining abundance trends. Evidence suggests that interactions with fisheries are contributing to the decline of the fisheries. Between 2017 and 2018, there were 20 known right whale mortality events, and more than half of these were the direct result of entanglement or vessel strike. Right whale distributions may also be changing with climate related distribution shifts of their main food source, Calanus finmarchicus. 
---
## SOE 2019: Protected species
**Harbor porpoise**

```{r harbor-porpoise-bars, fig.width = 8, fig.align="center", fig.height = 6}
source("R/hp_density_plot.R")
hp_bycatch  <- ecodata::harborporpoise %>% 
  spread(.,Var,Value) %>% 
ggplot() +
    annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line(aes(x = Time, y = `harbor porpoise bycatch estimate`, color = "Harbor Porpoise Bycatch"), size = lwd) +
  geom_point(aes(x = Time, y = `harbor porpoise bycatch estimate`, color = "Harbor Porpoise Bycatch"), size = pcex) +
  geom_errorbar(aes(x = Time,
                    ymin = `harbor porpoise bycatch lo95ci`,
                  ymax = `harbor porpoise bycatch up95ci`,
                  color = "Harbor Porpoise Bycatch"), 
                width = 0.25)+
  geom_line(aes(x = Time, y = `harbor porpoise bycatch pbr`, color = "PBR"), size = lwd-0.1) +
  scale_color_manual("", values = c("Harbor Porpoise Bycatch" = "black", "PBR" = "red")) +
  guides(color = guide_legend(override.aes = list(shape = c(19,NA)))) +
  scale_x_continuous(expand = c(0.01, 0.01)) +
  ggtitle("Harbor porpoise bycatch") +
  ylab("Bycatch Estimate (n)") +
  theme_ts() +
  theme(legend.position = c(0.4, 0.85),
        legend.background = element_rect(fill = "transparent"),
        axis.title = element_text(size = 14),
        plot.title = element_text(size = 16, face = "bold"))

xlims <- c(-78, -66)
ylims <- c(35, 46)
fall_hp <- hp_density("Fall", lat = F)
spring_hp <- hp_density("Spring", leg = F)

(spring_hp | fall_hp ) /
  hp_bycatch + plot_layout(ncol = 1, heights = c(1.5, 1.25)) & theme(plot.margin = margin(0,0,0.3,0,"cm"))

```

* Current bycatch levels suggest that management actions have been effective in reducing harbor porpoise bycatch

???
The maps here show density estimates of the widely distributed harbor porpoise in the spring and fall months, as estimated by the Atlantic Marine Assessment Program for Protected Species.

The red line in the time series plot shows the potential biological removal. Above this line removals from the population will prevent the stock from reaching a stable population size. 

2016 and 2017 estimates for bycacth are among the lowest values in the series, suggest that management actions have been effective in reducing harbor porpoise bycatch. 
---
## SOE 2019: Protected species
**Common tern diet diversity**
.pull-left[
* Warmer waters affect vertical distribution of prey species

  * Results in more generalist diet choices
* High diet diversity in past decade may be the result of decreases in preferred prey type (hake, sandlance)
]
.pull-right[
```{r tern-diet-diversity, fig.height=8}

diet_div <- ecodata::common_tern %>% 
  filter(str_detect(Var, "Diet"),
         !str_detect(Var, "Sum")) %>% 
  mutate(Island = word(Var, 1),
         Var = word(Var, 4)) %>% 
  group_by(Island, Time) %>%
  dplyr::summarise(evenness = diversity(Value)/log(specnumber(Value)),
                   shannon = diversity(Value),
                   simpson = diversity(Value, index = "simpson")) %>% 
  gather(.,Var,Value,-Island, -Time) %>% 
  group_by(Var, Time) %>%
  dplyr::summarize(Value = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   n = n()) %>%
  group_by(Var) %>% 
  mutate(hline = mean(Value, na.rm = T))

shannon <- diet_div %>% 
  filter(Var == "shannon") %>% 
ggplot(aes(x = Time, y = Value)) +
      annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line() +
  geom_point() +
  #geom_gls() +
  scale_x_continuous(expand = c(0.01, 0.01),limits = c(1992,2018)) +
  ggtitle("Common tern diet diversity")+
  ylab(expression("Shannon Diversity")) +
  xlab("")+
  geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  theme_ts() +
  theme(axis.title = element_text(size = 14),
          plot.title = element_text(size = 16, face = "bold"))

source("R/get_tern_map.R")
tern_loc <- get_tern_map()
tern_loc + shannon + plot_layout(ncol = 1, heights = c(1,0.75))
```
]

---
## SOE 2019: Protected species
**Common tern diet diversity**
* Warmer waters result in *butterfish* appearing in common tern diet
  * May cause starvation or require parents to increase foraging effort
* High diet diversity in past decade may be the result of decreases in preferred prey type (hake, sandlance)

```{r stacked-bar-prey-freq,out.width='100%', fig.height=5}

prey_freq <- ecodata::common_tern %>% 
  filter(str_detect(Var, "Diet"),
         !str_detect(Var, "Sum")) %>% 
    mutate(Island = word(Var, 1),
         Var = word(Var, 4)) %>%
    group_by(Var, Time) %>% 
    dplyr::summarise(Value = sum(Value, na.rm = T)) %>% 
    group_by(Time) %>% 
    mutate(Freq = Value/sum(Value, na.rm = T)) %>% 
    group_by(Var) %>% 
  mutate(hline = mean(Freq, na.rm = T))

diet_freq_bar <- prey_freq %>% 
  filter(Freq > 0.05) %>% 
  dplyr::mutate(Prey = gsub("\\.", " ", Var)) %>% 
  # dplyr::rename(Prey = Var) %>%
  ggplot(aes(x = Time, y = Freq, fill = Prey)) +
  geom_bar(stat = "identity") +
  scale_x_continuous(expand = c(0.01, 0.01))+
  scale_fill_manual(values = RColorBrewer::brewer.pal(10,"Paired")) +
  ggtitle("Prey composition") +
  ylab("Proportion of prey items") +
  theme_ts()

diet_plotly <- ggplotly(diet_freq_bar)
diet_plotly
```

???
* Common tern breeding colonies are monitored in the southern GOM
* Common tern sensitive to vertical distribution of prey



---
## SOE 2019: Fish and invertebrates
**Objective: Keep harvested species within population ranges where productivity is maximized over long-term**
```{r NE-stock-status, fig.width = 8, fig.asp = 0.75, fig.align="center"}

#Get data, spread for plotting, and filter
stock_status <- ecodata::stock_status %>%
  spread(.,Var,Value) %>% 
  filter(Council %in% c("NEFMC","Both"))

#Plot constants
y.max <- 4
x.max <- 7.5

all_missing <- stock_status %>%
  filter(is.na(B.Bmsy),is.na(F.Fmsy)) %>% 
  dplyr::select(Code, Council)

b_missing <- stock_status %>%
  filter(is.na(B.Bmsy), !is.na(F.Fmsy)) %>% 
  dplyr::select(Code, Council)

f_missing <- stock_status %>%
  filter(is.na(F.Fmsy), !is.na(B.Bmsy)) %>% 
  dplyr::select(Code, Council)

#A dataframe that defines custom legend for stocks with unknown status

all.df <- data.frame(text = all_missing$Code,
                    x = rep(x.max,length(all_missing$Code)),
                    y = seq(4.35,2.85,-0.22)-0.5,
                    color = all_missing$Council)

b.df <- data.frame(text = b_missing$Code,
                    x = rep(x.max*0.8,length(b_missing$Code)),
                    y = c(4.35,4.14)-0.5,
                    color = b_missing$Council)

f.df <- data.frame(text = f_missing$Code,
                    x = rep(x.max*0.6,length(f_missing$Code)),
                    y = seq(4.35,2.85,-0.22)-0.5,
                    color = f_missing$Council)


#Plotting code
ggplot(data = stock_status) +
  geom_vline(xintercept = 1, linetype = "dotted", color = "grey60")+
  geom_vline(xintercept = 0.5, linetype = "dashed", color = "grey60")+
  geom_hline(yintercept = 1, linetype = "dashed", color = "grey60") +
  geom_point(aes(x = B.Bmsy,
                 y = F.Fmsy,
                 color = Council,
                 shape = Council)) +
  geom_text_repel(aes(x = B.Bmsy, #geom_text_repel auto-jitters text around points
                      y = F.Fmsy,
                      label = Code,
                      color = Council), show.legend = FALSE,nudge_y = 0.05, nudge_x = 0.05) +
  ylim(0,y.max) +
  xlim(0,x.max*1.1) +
  geom_text(data = all.df, aes(x = x, y = y, label = text, color = color),show.legend = FALSE, size = 3)+
  geom_text(data = b.df, aes(x = x, y = y, label = text, color = color),show.legend = FALSE, size = 3)+
  geom_text(data = f.df, aes(x = x, y = y, label = text, color = color),show.legend = FALSE, size = 3)+
  scale_color_manual(values = c("purple","blue"),#c("purple","blue"), #Change legend labels for clarity
                   name = "Managed by",
                   breaks = c("Both","NEFMC"),
                   labels = c("MAFMC/NEFMC","NEFMC"))+
  scale_shape_manual(values = c(1, 19), #Change legend labels for clarity
                     name = "Managed by",
                     breaks = c("Both","NEFMC"),
                     labels = c("MAFMC/NEFMC","NEFMC"))+
  annotate("text", x = 7.5, y = y.max, label = "F and B missing", fontface =2, size = 3)+
  annotate("text", x = 6, y = y.max, label = "B missing", fontface =2, size = 3)+
  annotate("text", x = 4.5, y = y.max, label = "F missing", fontface =2, size = 3)+
  xlab(expression(~B/B[msy])) +
  ylab(expression(~F/F[msy])) +
  ggtitle("New England Stock Status") +
  theme_ts()
```

* 4 stocks above F/F<sub>msy</sub> and below B/B<sub>msy</sub>
  * Southern NE Yellowtail, GOM Cod, CC-GOM Yellowtail, Southern GB/MAB red hake
  
???
Stocks depicted here represent a subset of the full ecosystem

---
## SOE 2019: Fish and invertebrates
**Objective: Keep harvested species within population ranges where productivity is maximized over long-term**

```{r stock-status, fig.width = 8, fig.asp = 0.75, fig.align="center"}

#Get data, spread for plotting, and filter
stock_status <- ecodata::stock_status %>%
  spread(.,Var,Value) %>% 
  filter(Council %in% c("MAFMC","Both"))

#Plot constants
y.max <- 2.0 #1.75 mackerel cut off F/Fmsy is 1.8
x.max <- 2.6

#A dataframe that defines custom legend for stocks with unknown status

unknown <- data.frame(text = c("Unknown Status", "Longfin",
                              "Illex", "N. Goosefish", "S. Goosefish"),
                    x = rep(0.9*x.max,5),
                    y = seq(0.93*y.max,1.4,-.1))


#Plotting code
ggplot(data = stock_status) +
  geom_vline(xintercept = 1, linetype = "dotted")+
  geom_vline(xintercept = 0.5, linetype = "dashed")+
  geom_hline(yintercept = 1, linetype = "dashed") +
  geom_point(aes(x = B.Bmsy,
                 y = F.Fmsy,
                 color = Council)) +
  geom_text_repel(aes(x = B.Bmsy, #geom_text_repel auto-jitters text around points
                      y = F.Fmsy,
                      label = Code,
                      color = Council), show.legend = FALSE,nudge_y = 0.05, nudge_x = 0.05) +
  scale_color_manual(values = c("purple","blue"), #Change legend labels for clarity
                     name = "Managed by",
                     breaks = c("Both","MAFMC"),
                     labels = c("MAFMC/NEFMC","MAFMC"))+
  ylim(0,y.max) +
  xlim(0,x.max) +
  geom_text(data = unknown, aes(x = x, y = y, label = text), #Custom legend for unknown stock status
            size = c(4.75,rep(4,4)),
            color = c("black",rep("blue",2), rep("purple",2))) +
  xlab(expression(~B/B[msy])) +
  ylab(expression(~F/F[msy])) +
  ggtitle("Mid-Atlantic Stock Status") +
  theme_ts()
```

* No stock above F/Fmsy and below B/Bmsy
* Mackerel currently seeing unsustainable fishing mortality

???
Plot shows the ratio of stock mortality (F) to stock mortality at maximum sustainable yield, where a number larger than one indicates the stock is experiencing unsustainable fishing pressure. On the x axis we have the ratio of estimated stock biomass to biomass at maximum sustainable yield. 

---
## SOE 2019: Fish and invertebrates
**Changing distributions**

```{r spec_prop, fig.width = 8, fig.height = 4, fig.align="center"}
source("R/get_spec_prop.R")
nefmc_benth_in_mid <- get_species_prop_plots(guild = "Benthivore", epu = "MAB",managed_by = "NEFMC",region = "the Mid-Atlantic")

mafmc_plank_in_gom <- get_species_prop_plots(guild = "Planktivore", epu = "GOM",managed_by = "MAFMC",region = "Gulf of Maine")

mafmc_plank_in_gb <- get_species_prop_plots(guild = "Planktivore", epu = "GB",managed_by = "MAFMC",region = "Georges Bank")

nefmc_benth_in_mid
```


* Decline in proportion of NEFMC in MAB driven mostly by ocean pout
* Increase in MAFMC species proportiongs in GOM/GB driven by mackerel


.footnote[
https://seanhardison.shinyapps.io/surv_app/ 
]

???
Traditional fisheries management is based around stable species distributions, but those distributions aren't static, and especially not in the context of changing ecosystem conditions

The NEFSC has run a bottom trawl survey since the early 1960s, and these figures highlight how distributions of managed species within feeding guilds have changed. 

The decline in NEFMC species in the mid survey is driven mostly by ocean pout, which has seen proportional declines in the gulf of maine and georges bank survey

---
## SOE 2019: Fish and invertebrates
**Changing distributions**

```{r, fig.width = 7.5, fig.height=6.5, fig.align="center"}

mafmc_plank_in_gom + mafmc_plank_in_gb + plot_layout(ncol = 1)

```


* Increase in MAFMC species in GOM and GB driven by mackerel

---
## SOE 2019: Fish and invertebrates
**Bottom trawl surveys: New England**

```{r ne-survey, fig.width = 15, fig.height = 8}
  #facet names for titles
  facet_names <- list("Piscivores" = expression("Piscivores"),
                      "Planktivores" = expression("Planktivores"),
                      "Benthivores" = expression("Benthivores"),
                      "Benthos" = expression("Benthos"))
source("R/get_survey_plots.R")

ne_surv <- get_survey_plots(region = "NE")
ne_surv[[1]] + ne_surv[[2]] + plot_layout(ncol = 2)
```


???
* In Gulf of Maine, the survey data show long-term increases in the Fall survey for Piscivores, Planktivores, and Benthos species, and long-term increases in planktivore abundance in the spring. 
* In Georges Bank, the survey shows long-term increases for benthos and planktivore species in both fall and spring, and piscivores in the fall.
* A recent decline in Georges Bank benthivore biomass is driven by a decline in haddock in the survey

---
## SOE 2019: Fish and invertebrates
**Bottom trawl surveys: Mid-Atlantic**

.pull-left[

* NEFSC bottom trawl survey data paired with NEAMAP inshore bottom trawl data from the region

* Opposing trends in piscivore biomass during the spring and fall seasons for the offshore survey. 

]

.pull-right[
```{r ma-survey, out.width="100%", fig.height = 9}
 
(ma_surv <- get_survey_plots(region = "MAB"))
```
]



.footnote[
[1] [View all survey data](https://noaa-edab.github.io/ecodata/macrofauna)

[2] [Explore survey proportions](https://seanhardison.shinyapps.io/surv_app/)
]

???
For the Mid, we show offshore bottom trawl survey data paired with inshore bottom trawl data collected in the region by Northeast Area Monitoring and Assessment Program.

There appear to be opposing trends in spring piscivore biomass between the two surveys, which could reflect higher prevalence of spiny dogfish offshore

We didn't include the data in this presentation, but we also recieved inshore survey data from the Maine/New Hampshire survey and Mass state survey, and we hope to take a deeper look over the next SOE cycle

---
## SOE 2019: Fish and invertebrates
**Fish condition**

* Fish condition is measured at the weight at a given length relative to the average
  * Condition, or "fatness", is a factor that influences fecundity

*NEFMC Condition Factor*
```{r fish-con2, fig.align="center",out.width="75%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/NEFMC_Fish_Condition_2019.jpg")
```


???
Looking at condition in aggregate across all managed stocks, we can see a clear decline in condition between 2000-2010

Recent improvement within past decade

Interestingly, the drop-off in condition around 2000 resembles a shift in zooplankton size-structure on the shelf, and this is a topic for future research


---
## SOE 2019: Fish and invertebrates
**Fish productivity**

The fish productivity indicator shown here is the small fish per large fish biomass anomaly


```{r fish-prod, fig.align = "center", fig.height = 4, fig.width=8}
source("R/productivity_plots.R")
prod <- productivity_plots()
prod
```

???
In the Mid, there seems to be a decline in productivity in recent years, due to changes in recruitment and survival. 

In the past 5 years, strong productivity years for witch flounder, silver hake, and winter flounder have driven increases

---
## SOE 2019: Fish and invertebrates
**Larval diversity**
The last thing I'll talk about from the fish and intertebrates section is our metric of larval diversity, which was derived from the NEFSC Ecosystem Monitoring cruises. 

The diversity index tells us about the changing dominance of forage fish, hake, and haddock in the plankton

The most recent data we have for the Mid-Atlantic has shown the lowest larval estimates of larval diversity in the time series. As temperatures increase, there is a potential for a temporal mismatch of larvae with their zooplankton food sources, which could affect larval survival.

---
## SOE 2019: Habitat quality and ecosystem productivity

Indicators here provide information about:

* Changing conditions encountered by managed species in different seasons and across habitats, which likely influences their distributions

**Chesapeake Bay Water Quality**

```{r cb-water-qual, fig.height = 3.5, fig.align = "center"}
minlab <- seq(1985,2015,5)
maxlab <- seq(1987,2017,5)

ecodata::ches_bay_wq %>% 
  mutate(hline = mean(Value)) %>% 
  ggplot(aes(x = Time, y = Value)) +
       annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line() +
  geom_point() +
  geom_gls() +
    ylab(expression("Estimated attainment, percent")) +
  ggtitle("Chesapeake Bay Estimated Water Quality Standards Attainment") +
  scale_x_continuous(breaks = minlab,labels = paste0(minlab,"-",maxlab),expand = c(0.01, 0.01)) +
    geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  theme_ts() +
  theme(axis.title = element_text(size = 14))
```


???
First indicator I'd like to talk about is a new water quality for Chesapeake Bay, which many resource species use as nursery habitat or are dependent upon (e.g. bluefish, striped bass, menhaden, black sea bass)

These data, which were provided by collaborators at the Chesapeake Bay Program, represent the percent of tidal waters in Chesapeake Bay meeting water quality standards for chlorophyll a, submerged aquatic vegetation, and dissolved oxygen. The increase in water quality for the Bay has been tied to management action limiting nutrient influx into the watershed. 



---
## SOE 2019: Habitat quality and ecosystem productivity
**Ocean temperature: New England**

Warming oceans have implications for suitable fish habitat, which is predicted to decline for many NE species<sup>1</sup>

.footnote[
Kleisner, Kristin M., et al. "Marine species distribution shifts on the US Northeast Continental Shelf under continued ocean warming." Progress in Oceanography 153 (2017): 24-36.
]

```{r ne-sst, fig.align = "center", fig.height = 6, fig.width = 12}
epu_sf <- ecodata::epu_sf %>% 
  filter(EPU %in% c("GOM","GB"))

#Map line parameters
map.lwd <- 0.4

# Set lat/lon window for maps
xmin = -73
xmax = -65
ymin = 39
ymax = 45
xlims <- c(xmin, xmax)
ylims <- c(ymin, ymax)
sst <- seasonal_oisst_anom_gridded 

sst$Season <- factor(sst$Season, levels = c("Winter",
                                            "Spring",
                                            "Summer",
                                            "Fall"))
sst_map <- 
  ggplot() +
  geom_tile(data = sst, aes(x = Longitude, y = Latitude,fill = Value)) +
  geom_sf(data = coast, size = map.lwd) +
  geom_sf(data = epu_sf, fill = "transparent", size = map.lwd) +
  scale_fill_gradient2(name = "Temp.\nAnomaly (°C)",
                       low = scales::muted("blue"),
                       mid = "white",
                       high = scales::muted("red"),
                       limits = c(-5,5)) +
  coord_sf(crs = crs, xlim = xlims, ylim = ylims) +
  facet_wrap(Season~.) +
  theme_map() +
  ggtitle("SST anomaly (2018)") +
  xlab("Longitude") +
  ylab("Latitude") +
  theme(panel.border = element_rect(colour = "black", fill=NA, size=0.75),
        legend.key = element_blank(),
        axis.title = element_text(size = 11),
        strip.background = element_blank(),
        strip.text=element_text(hjust=0),
        axis.text = element_text(size = 8))


ne_anom <- seasonal_oisst_anom %>% 
  filter(EPU %in% c("GOM","GB")) %>% 
    mutate(hline = 0,
           Var = str_to_title(str_extract(Var,"winter|spring|summer|fall")))
ne_anom$Var <- factor(ne_anom$Var, levels= c("Winter","Spring","Summer","Fall"))

ne_anom_plt <- ggplot(data = ne_anom, 
       aes(x = Time, y = Value, color = EPU, group = EPU))+ #plot
     annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line()+
  geom_point()+
  ylim(-2,3)+
  geom_gls() +
  ylab(expression("SST Anomaly (°C)")) +
  ggtitle("Gulf of Maine & Georges Bank SST Anomaly") +
    scale_color_manual(values = c("black","indianred"))+
    scale_x_continuous(expand = c(0.01, 0.01)) +
    geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  facet_wrap(Var ~., ncol = 2, scales = "free_y")+
  theme_facet() +
  theme(strip.text=element_text(hjust=0),
        plot.title = element_text(size = 16))

sst_map + ne_anom_plt 
```

* Gulf of Maine summer SSTs were the highest on record in 2018 (~3°C > long-term mean)

???
These changes have implications for fish populations in the region that are already at the southern extent of their ranges, like Atlantic cod. Suitable habitat for these species is predicted to contract as waters continue to warm. 

---
## SOE 2019: Habitat quality and ecosystem productivity
**Ocean temperature: New England**

Much the same for bottom temperatures in the region

```{r ne-bot-temp, fig.height = 5, fig.align = "center", fig.width = 7}
bot_temp_insitu_gom <- oceantemp_insitu %>%
  filter(EPU == "GOM",
         Var == "bottom temp anomaly in situ") %>% 
  mutate(hline = 0) %>% 
    ggplot()+ #plot
     annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line(aes(x = Time, y = Value)) +
  geom_gls(aes(x = Time, y = Value)) +
  geom_point(aes(x = Time, y = Value), size = 1) +
  ylab("Temp. Anomaly (°C)") +
  ggtitle("GOM Bottom Temperature Anomaly") +
  scale_x_continuous(expand = c(0.01, 0.01)) +
    geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  theme_ts() +
  theme(strip.text=element_text(hjust=0),
        plot.title = element_text(size = 16),
        axis.title = element_text(size = 14))


bot_temp_insitu_gb <- oceantemp_insitu %>%
  filter(EPU == "GB",
         Var == "bottom temp anomaly in situ") %>%
   mutate(hline = 0) %>% 
    ggplot()+ #plot
     annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_line(aes(x = Time, y = Value)) +
  geom_gls(aes(x = Time, y = Value)) +
  geom_point(aes(x = Time, y = Value), size = 1) +
  ylab("Temp. Anomaly (°C)") +
  ggtitle("GB Bottom Temperature Anomaly") +
  scale_x_continuous(expand = c(0.01, 0.01)) +
    geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty) +
  theme_ts() +
  theme(strip.text=element_text(hjust=0),
        plot.title = element_text(size = 16),
        axis.title = element_text(size = 14))



bot_temp_insitu_gom +
 bot_temp_insitu_gb + 
  plot_layout(ncol =  1) &
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))
```


---
## SOE 2019: Habitat quality and ecosystem productivity
**Ocean temperature: Mid-Atlantic**

```{r mab-sst, fig.align = "center", fig.width=9, fig.height=7}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/sst-anom.png")
```

???
The same is true for the Mid-Atlantic Bight
* Mid-Atlantic summer SSTs were 3rd highest on record 

As I noted earlier, some species in the Mid-Atlantic could actually see range expansions due to warming ocean temperatures, including croaker and striped bass. 

---
## SOE 2019: Habitat quality and ecosystem productivity
**Ocean circulation**

```{r atl-circ, out.width="50%", fig.align="center"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/nw-atlantic-circ.jpg")
```


.footnote[
Townsend, D. W., Pettigrew, N. R., Thomas, M. A., Neary, M. G., McGillidcuddy, D. J., O'Donnell, J (2015), Water masses and nutrient sources to the Gulf of Maine, Journal of Marine Research, 73: 93-122.
]

???
Regional currents are major influencers of ocean temperatures in the NW Atlantic 

The Gulf Stream is a reliable indicator of bottom water temps

An offshoot of the gulf stream is the warm slope water, which makes its way into gulf of maine through the northeast channel

---
## SOE 2019: Habitat quality and ecosystem productivity
**Ocean circulation**

Which brings us back to...

```{r gsi_sw, fig.width = 12, fig.height = 4, fig.align="center"}
gsi_plt <- gsi %>% 
  mutate(Year = floor(Time)) %>% 
  group_by(Year) %>% 
  dplyr::summarise(Value = mean(Value)) %>% 
  mutate(hline = mean(Value)) %>% 
  dplyr::rename(Time = Year) %>% 
  ggplot(aes(x = Time, y = Value)) +
         annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_gls() +
  geom_line() +
  geom_point() +
  ylab("Position anomaly") +
  ggtitle("Gulf Stream Index") +
    scale_x_continuous(expand = c(0.01, 0.01))+
      geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_ts() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"),
        axis.title = element_text(size = 14),
        plot.title = element_text(size = 16, face = "bold"))

sw.df <- slopewater %>% 
  mutate(Var, Var = plyr::mapvalues(Var, from = c("WSW proportion ne channel",
                                                  "LSLW proportion ne channel"),
                                    to = c("WSW","LSLW"))) %>% 
  dplyr::rename(Flavor  = Var) %>% 
  group_by(Flavor) %>% 
  mutate(hline = mean(Value)) 

sw.df$Flavor <- factor(sw.df$Flavor, levels = c("WSW","LSLW"))

sw_plt <- ggplot(data = sw.df) +
  geom_line(aes(x = Time, y = Value, color = Flavor))+
  geom_point(aes(x = Time, y = Value, color = Flavor)) +
  ylab("Percent of Total Slopewater") +
  ggtitle("Slopewater Proportions in NE Channel")+
    scale_x_continuous(expand = c(0.01, 0.01))+
      geom_hline(aes(yintercept = hline,
                     color = Flavor),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_ts() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"),
        axis.title = element_text(size = 14),
        plot.title = element_text(size = 16, face = "bold"))

gsi_plt + sw_plt 
```


???
Over the past few years, we've seen a strong departure of the gulf stream north wall from it's mean latitude

With that comes a larger percentage of warm slope water entering into gulf of maine through the NE channel

---

## SOE 2019: Habitat quality and ecosystem productivity
**Primary production**
* Summer PP is increasing in both New England and Mid-Atlantic

```{r pp-trends, fig.width=10, fig.height = 5}
out_pp <- ecodata::chl_pp %>% 
  filter(EPU %in% c("GOM","GB"),
         str_detect(Var, "MONTHLY_PPD_MEDIAN")) %>% 
  separate(.,Time, into = c("Year","Month"), sep = 4) %>% 
    mutate(Month = plyr::mapvalues(Month, from = c("01","02","03","04","05","06",
                                                   "07","08","09","10","11","12"),
                                   to = c(month.abb))) %>% 
  group_by(EPU, Month) %>% 
  mutate(hline = mean(Value))
out_pp$Month <- factor(out_pp$Month, levels = month.abb)

 
 pp_cci_gb <-out_pp %>% 
  filter(EPU == "GB") %>% 
 ggplot() +
   # geom_gls(aes(x = Year, y = Value, group = Month))+
    geom_point(aes(x = Year, y = Value, group = Month)) +
    geom_line(aes(x = Year, y = Value, group = Month)) +
    scale_x_discrete(name = "Time", breaks = seq(min(out_pp$Year),max(out_pp$Year),10)) +  
    facet_wrap(Month~., ncol = 6) +
    ggtitle("GB Monthly median PPD") +
    ylab(expression("PP (gC m"^-2*" d"^-1*")")) +
        geom_hline(aes(yintercept = hline,
                     group = Month),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
    theme_facet() +
    theme(axis.text.x = element_text(angle=45, hjust = 1),
          panel.spacing = unit(1, "lines"),
          plot.margin = unit(c(0.1, 0, 0, 0), "cm"))
 
 pp_cci_gb 
 
```


???
* Driven by warmer temperatures and increased bacterial remineralization and nutrient recycling
* Increasing primary production likely due to higher productivity of smaller phytoplankton


---
## SOE 2019: Habitat quality and ecosystem productivity
**Primary production and copepod size structure**

* Primary production may play a role in zooplankton size dynamics on the shelf

```{r MAB-sli, fig.height = 6, fig.align = "center", fig.width = 9}
source("R/sli_plots.R")
gb_out <- sli_plots("GB")
gom_out <- sli_plots("GOM")

gb_out[[1]] + gom_out[[1]] + 
  gb_out[[2]] + gom_out[[2]] +
  plot_layout(ncol = 2) & theme(plot.margin = margin(t = 0, r= 1))
```

???
To assess the size structure of copepods in the region, we use the small-large index.
* A measure of relative size composition of the dominant copepod taxa
* A lower value means higher abundance of large copepods (<i>Calanus</i>)
* Primary production may play a role in copepod size dynamics***
---
## SOE 2019: Habitat quality and ecosystem productivity
**Zooplankton abundance**
* Seasonal abundances of key zooplankton species
  * Opposing trends in <i>Centropages</i> in spring and fall, which corresponds to a shift in timing of their peak concentration from late fall to early spring<sup>1</sup>
  
```{r seasonal-zoo, fig.width = 8, fig.asp = .6, fig.align = "center"}
facet_names <- list(
  'centropages spring'=expression(paste(italic("Centropages "), "spring")),
  'centropages fall'=expression(paste(italic("Centropages "), "fall")),
  'temora spring'=expression(paste(italic("Temora "), "spring")),
  'temora fall' = expression(paste(italic("Temora "), "fall")),
  'pseudocalanus spring'=expression(paste(italic("Pseudocalanus "), "spring")),
  'pseudocalanus fall' = expression(paste(italic("Pseudocalanus "), "fall")))

zoo_oi_mab <- ecodata::zoo_oi %>% 
  filter(!str_detect(Var,"SD"),
         EPU == "MAB") %>% 
  
  mutate(Var = str_remove(Var, " zoo"),
         Val2 = exp(Value)) %>% 
      group_by(Var) %>% 
  mutate(hline = mean(Val2, na.rm = T)) %>% 
  separate(.,col = Var, into = c("Species","Season"), remove = F)



top <- zoo_oi_mab %>%  
  filter(Species == "centropages") %>% 

ggplot(aes(x = Time, y = Val2, group = Var)) +
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = 0, ymax = Inf) +
  geom_hline(aes(yintercept = hline),
     size = hline.size,
     alpha = hline.alpha,
     linetype = hline.lty)+
  geom_gls() +
  geom_line()+
  geom_point()+
  ylab("") +
  facet_wrap(Var ~ ., ncol = 2, scales='free_x',labeller = label) +
  ggtitle("Zooplankton abundance (OI)") +
  scale_x_continuous(expand = c(0.01, 0.01))+
  scale_y_continuous(trans = "log10")+
  theme_facet() +
    theme(strip.text=element_text(hjust=0,
                                face = "italic"),
          axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

middle <- zoo_oi_mab %>%  
  filter(Species == "pseudocalanus") %>% 
ggplot(aes(x = Time, y = Val2, group = Var)) +
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = 0, ymax = Inf) +
  geom_hline(aes(yintercept = hline),
     size = hline.size,
     alpha = hline.alpha,
     linetype = hline.lty)+
  geom_gls() +
  geom_line()+
  geom_point()+
  ylab(expression("Abundance num m"^-3*"")) +
  facet_wrap(Var ~ ., ncol = 2, scales='free_x',labeller = label) +
  scale_x_continuous(expand = c(0.01, 0.01))+
  scale_y_continuous(trans = "log10")+
  theme_facet() +
    theme(strip.text=element_text(hjust=0,
                                face = "italic"),
          axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

bottom <- zoo_oi_mab %>%  
  filter(Species == "temora") %>% 
ggplot(aes(x = Time, y = Val2, group = Var)) +
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = 0, ymax = Inf) +
  geom_hline(aes(yintercept = hline),
     size = hline.size,
     alpha = hline.alpha,
     linetype = hline.lty)+
    geom_gls() +
  geom_line()+
  geom_point()+
    ylab("") +
  facet_wrap(Var ~ ., ncol = 2,labeller = label) +
  scale_x_continuous(breaks = seq(1980,2010,10),
                     expand = c(0.01, 0.01))+

  theme_facet() +
    theme(strip.text=element_text(hjust=0,
                                face = "italic")) +
   scale_y_log10()

top + middle + bottom + plot_layout(ncol = 1) & theme(plot.margin = margin(0,0,0,0,"cm"))
```

  
.footnote[
[1] Bi H, Ji R, Liu H, Jo Y-H, Hare JA. Decadal Changes in Zooplankton of the Northeast U.S. Continental Shelf. PLOS ONE. 2014;9: e87720. doi:10.1371/journal.pone.0087720
]

---
## SOE 2019: Takeaways

* Even though the NE is "data rich", there are large gaps in our understanding of the system

--

* Changes in climate dynamics affect all nodes of NES network in different ways, but all have implications for human-ecosystem interactions and community well-being

--

* Making managers aware of the trends in ecosystem components is important for integrated and sustainable management strategies of the the fisheries sector (EBFM)

---
## SOE 2019: Reproducibility and provenance

* Reporting the information is not enough

* Managers appreciate the concise format, but back-end critical for describing collection, analyses, and processing
  
![soe-data-flow](20190313_EBFMseminar_Hardison_images/soe-data-flow.png)  

???
This workflows also ensures that there's no information lost between SOE cycles. We know exactly how a data set was analyzed and handled so that the data can be updated for next year's reports.

---
## Contributors - THANK YOU!

The New England and Mid-Atlantic SOEs made possible by (at least) 38 contributors from 8 intstitutions 

.pull-left[
.contrib[
Donald Anderson (Woods Hole Oceanographic Institute) <br>
Amani Bassyouni (Virginia Department of Health)<br>
Lisa Calvo (Rutgers)<br>
Matthew Camisa (MA Division of Marine Fisheries) <br>
Patricia Clay<br>
Lisa Colburn<br>
Geret DePiper<br>
Deb Duarte<br>
Michael Fogarty<br>
Paula Fratantoni <br>
Kevin Friedland<br>
Sarah Gaichas<br>
James Gartland (Virginia Institute of Marine Science)<br>
Heather Haas<br>
Sean Hardison <br>
Kimberly Hyde<br>
Terry Joyce (Woods Hole Oceanographic Institute)<br>
John Kosik<br>
Steve Kress (National Audubon Society)<br>
Scott Large
]
]

.pull-right[
.contrib[
Don Lyons (National Audubon Society)<br>
Loren Kellogg<br>
David Kulis (Woods Hole Oceanographic Institute)<br>
Sean Lucey<br>
Chris Melrose<br>
Ryan Morse<br>
Kimberly Murray<br>
Chris Orphanides<br>
Richard Pace<br>
Charles Perretti<br>
Karl Roscher (Maryland Department of Natural Resources)<br>
Vincent Saba<br>
Laurel Smith<br>
Mark Terceiro<br>
John Walden<br>
Harvey Walsh<br>
Mark Wuenschel<br>
Qian Zhang (Unversity of Maryland and US EPA Chesapeake Bay Program)
]
]

```{r iea-logo, fig.align="center", out.width = "50%"}
knitr::include_graphics("20190313_EBFMseminar_Hardison_images/noaa-iea.png")
```

---
## External Resources

* [SOE Technical Documentation](https://noaa-edab.github.io/tech-memo)

* [ecodata R package](https://github.com/noaa-edab/ecodata)

  * [Macrofauna indicators](http://noaa-edab.github.io/ecodata/macrofauna)
  * [Human Dimensions indicators](http://noaa-edab.github.io/ecodata/human_dimensions)
  * [Lower trophic level indicators](http://noaa-edab.github.io/ecodata/LTL)
  
* [ERDDAP server](https://comet.nefsc.noaa.gov/erddap/index.html)

* Slides available at https://seanhardison1.github.io/soe-presentation

---
## Species compositions by feeding guild
.table[
```{r feeding-guilds}
# new table with all species listed by management entity
df <- ecodata::species_groupings %>%
  dplyr::select(SOE_18, COMNAME, Fed_Managed) %>%
  filter(SOE_18 != "Other") %>%
  distinct() %>%
  group_by(SOE_18, Fed_Managed) %>%
  summarize_all(funs(paste(na.omit(.), collapse = ", "))) %>%
  spread(Fed_Managed, COMNAME) %>%
  arrange(factor(SOE_18, levels = c("Apex Predator", "Piscivore", "Planktivore", "Benthivore", "Benthos")))
df<-df[-6,c(1,4,3,5,6)] %>%
  mutate_all(tolower)


knitr::kable(df, caption = 'Feeding guilds and management bodies.', 
             col.names = c("Guild", "MAFMC", "Joint", "NEFMC", "State or Other")) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  column_spec(1, width="2cm") %>%
  column_spec(2, width="4cm") %>%
  column_spec(3, width="2cm") %>%
  column_spec(4, width="5cm") %>%
  column_spec(5, width="6cm")

```
]

