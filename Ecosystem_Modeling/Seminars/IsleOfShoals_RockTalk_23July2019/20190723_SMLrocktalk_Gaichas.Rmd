---
title: "Fishing within food webs:"
subtitle: "Modeling for management advice"
author: "Sarah Gaichas<br /> Northeast Fisheries Science Center"
output:
  xaringan::moon_reader:
    css: ["default", "libs/EDAB_theme2.css"]
    lib_dir: libs
    nature:
      titleSlideClass: ["right", "middle", "my-title"]
      highlightStyle: githubp
      highlightLines: true
      countIncrementalSlides: false
  revealjs::revealjs_presentation:
    self_contained: false
    reveal_plugins: ["notes", "search"]
---
class: top, left

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = F,
                      warning = F,
                      message = F)
#Plotting and data libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(here)
library(kableExtra)
library(ggrepel)
library(stringr)

library(atlantisom)

data.dir <- here::here("data")

```

## What does modeling have to do with management?

![NOAA fisheries](EDAB_images/noaafisheries.png)
![NOAAlogo](EDAB_images/noaa-logo.PNG)

---
## What kinds of models are there?

![ecomods](EDAB_images/ecomods.png)
---
## Conclusion: which models are best for management decisions?
.pull-left[
- Based on **clearly specified questions** (from managers/stakeholders)

- **Outputs** and **controls designed** to answer the questions

- Using **observations** directly from the ecosystem

- With clear description of **uncertainties**

]
.pull-right[
![models](EDAB_images/xkcdphysicists.png)
.footnote[https://xkcd.com/793/]
]


---
## Food webs and fisheries--two examples

- Preface: What is a "forage fish"?

- Alaska pollock: ecological research with a food web model  
  *"How does ecosystem structure affect dynamics?"*  
    - Distinguishing climate, fishing, and food web interactions  
    - Dealing with uncertainty  

- Atlantic herring: fishery management strategy evaluation  
  *"Which harvest control rules best consider herring's role as forage?"*  
    - Balancing fishing benefits and ecological services
    - Diverse stakeholder interests
    - Needed timely answers!
    
---
## What is a forage fish?

```{r forage, echo = F, fig.align = "center", out.width='67%'}
knitr::include_graphics("EDAB_images/forageSeattleTimes.png")
```

---
## How does ecosystem structure affect dynamics? 
![fwforcingstructure](EDAB_images/fwforcingstructuraltype.png)

---
## Alaska pollock: a tale of two ecosystems
![EBSGOAmaps](EDAB_images/EBSGOAmap.png)
---
## Alaska pollock: a tale of two ecosystems
![EBSGOAmapsfws](EDAB_images/EBSGOAmap_fws.png)  
    
---
## Alaska pollock: a tale of two ecosystems
```{r biodist, echo = F, fig.align = "center", out.width="75%"}
knitr::include_graphics("EDAB_images/EBSGOAbiodist.png")
```

???
Similar biomass groups up to TL 3

EBS pollock dominate at TL 3.5, highest biomass of any fish

GOA has highest biomass above TL 4 (halibut, arrowtooth)

---
## Alaska pollock: a tale of two ecosystems
.pull-left[
- Different pollock trajectories

- Different pollock diets, mortality sources

```{r pollpic, echo = F, fig.align = "center", out.width="85%"}
knitr::include_graphics("EDAB_images/pollpic.png")
```

]
.pull-right[
```{r pollassess, echo = F, fig.align = "center", out.width="95%"}
knitr::include_graphics("EDAB_images/EBSGOApollassess.png")
#knitr::include_graphics("EDAB_images/EBSGOApolldietmort.png")
```
]
```{r polldietmort, echo = F, fig.align = "center", out.width="95%"}
#knitr::include_graphics("EDAB_images/EBSGOApollassess.png")
knitr::include_graphics("EDAB_images/EBSGOApolldietmort.png")
```

???
diets:- copepods, krill, pollock in EBS
      - krill, shrimp, some copepods in GOA

---
## Ecosystem models and uncertainty
![aydinmodyield](EDAB_images/AydinModYield.png)
---
## Model ensemble https://xkcd.com/1885/
![xkcd_ensemble_model_2x.png](EDAB_images/xkcd_ensemble_model_2x.png)
---
## What is a food web model?

.pull-left-60[
A system of linear equations

For each group, $i$, specify: 

   Biomass $B$ [or Ecotrophic Efficiency $EE$ ]  
   Population growth rate $\frac{P}{B}$  
   Consumption rate $\frac{Q}{B}$  
   Diet composition $DC$  
   Fishery catch $C$  
   Biomass accumulation $BA$  
   Im/emigration $IM$ and $EM$  
   
Solving for $EE$ [or $B$ ] for each group:
]

.pull-right-40[
![toyfoodweb](EDAB_images/toyfw.png)
]

$$B_i\Big(\frac{P}{B}\Big)_i*EE_i+IM_i+BA_i=\sum_{j}\Big[ B_j\Big (\frac{Q}{B}\Big)_j*DC_{ij}\Big ]+EM_i+C_i$$
???

---
## Ecosystem models and uncertainty: grading inputs
![fwpedigree](EDAB_images/fwpedigree.png)

---
## Ecosystem models and uncertainty: run a scenario
![fwuncert1](EDAB_images/Foodwebmodel_uncertaintyseries/Slide1.png)
---
## Ecosystem models and uncertainty: run a scenario
![fwuncert2](EDAB_images/Foodwebmodel_uncertaintyseries/Slide2.png)
---
## Ecosystem models and uncertainty: run a scenario
![fwuncert3](EDAB_images/Foodwebmodel_uncertaintyseries/Slide3.png)
---
## Ecosystem models and uncertainty: run a scenario in an ensemble
![fwuncert4](EDAB_images/Foodwebmodel_uncertaintyseries/Slide4.png)
---
## Ecosystem models and uncertainty: run a scenario in an ensemble
![fwuncert5](EDAB_images/Foodwebmodel_uncertaintyseries/Slide5.png)
---
## Ecosystem models and uncertainty: run a scenario in an ensemble
![fwuncert6](EDAB_images/Foodwebmodel_uncertaintyseries/Slide6.png)
---
## Ecosystem models and uncertainty: run a scenario in an ensemble
![fwuncert7](EDAB_images/Foodwebmodel_uncertaintyseries/Slide7.png)

---
## Defining ecosystem structure in the EBS and GOA

---
## Different dynamics in the two systems?

---
## 

---
# Are any herring harvest control rules good for both fisheries and predators?

Yes *

* in New England


---
## Design: Operating model scenario (climate and fishing)

```{r OMdesign, echo = F, fig.align = "center", out.width="85%"}
knitr::include_graphics("EDAB_images/projectionOMsetup.png")
```

--

.pull-left[
* Recruitment variability in the operating model

* Specify uncertainty in assessment inputs using `atlantisom`
]
.pull-right[
![sardinerec scale 100%](EDAB_images/CCAsardineRecVar.png)
]


---
## Stock assessment uncertainty

* Focus on climate impacts to growth and natural mortality (productivity)
* Full factorial design over common stock assessment assumptions

    * Growth:
      1. constant growth parameters
      1. regime shifts in growth parameters ([Stawitz et al. 2019](https://www.sciencedirect.com/science/article/abs/pii/S0165783619300049?via%3Dihub))
      1. empirical weight-at-age ([Kuriyama et al. 2016](https://www.sciencedirect.com/science/article/abs/pii/S0165783615300837))
      
    * Natural mortality:
      1. fixed at an “uninformed” constant value of 0.2
      1. fixed at a constant value that reflects the true average value (over time) from the OM
      1. establishing regimes by fixing at the true average values from the OM over specified time blocks
      
    * Also, an equally weighted ensemble of the 9 estimation models
    
* Stock synthesis framework initially, but extend to other assessment models, generalize, and use components of the REDUS framework

---
## Experimental design (figure added 7 June 2019)

```{r EMdesign, echo = F, fig.align = "center", out.width="80%"}
knitr::include_graphics("EDAB_images/expdesignfig.png")
```

---
## Make atlantis output into assessment model input

Example workflow: 

1. Get true biomass, abundance, age composition, length composition, weight at age, fishery catch, fishery catch at age, fishery length composition, and fishery weight age age for a "sardine-like species": https://sgaichas.github.io/poseidon-dev/FullSardineTruthEx.html

1. Format these outputs and get other life history parameters for input into a stock assessment model ([Stock Synthesis](https://www.sciencedirect.com/science/article/abs/pii/S0165783612003293), using [`r4ss`](https://github.com/r4ss)):
https://sgaichas.github.io/poseidon-dev/CreateStockSynthesis.html

1. Run the assessment model

---
## What can we do so far?
.pull-left[
Survey census test NOBA 
```{r ex-output1, echo = F, warning = F, message=F, fig.align = "center"}
knitr::include_graphics("EDAB_images/NOBAcensus.png")
```

True length composition NOBA
```{r ex-output3, echo = F, warning = F, message=F, fig.align = "center"}
knitr::include_graphics("EDAB_images/NOBAherringtruelf.png")
```

]
.pull-right[
Standard survey test CCA
```{r ex-output2, echo = F, warning = F, message=F, fig.align = "center"}
knitr::include_graphics("EDAB_images/CCsurveyex.png")
```

Survey length composition CCA
```{r ex-output4, echo = F, warning = F, message=F, fig.align = "center"}
knitr::include_graphics("EDAB_images/CCV3herringlfcomp.png")
```

]

---
## Full disclosure!

.pull-left[
Still working on:

1. Estimating total mortality to back out M

1. Splitting aggregate age groups into true ages (not needed for NOBA)

1. Interpolating aggregate age groups weight at age for true ages

1. Fishery catch weight by area

1. Generalizing for different Atlantis codebase vintages
]

.pull-right[
![workinprogress scale 100%](EDAB_images/work-in-progress.png)
]


---
## Specify uncertainty in assessment "data": REDUS to the rescue!

What level of uncertainty is appropriate to carry through these analyses?
.pull-left[
1. Biological:

    1. appropriate sigma-R?

1. Survey specification:

    1. timing and spatial coverage?

    1. which species are captured?

    1. species-specific survey efficiency ("q")?

    1. selectivity at age for each species?

] 
.pull-right[
1. Survey uncertainty:

    1. additional observation error (survey cv for index)?
    
    1. effective sample size for biological samples?
    
1. Fishery uncertainty:
    
    1. additional observation error (catch cv for total)?
    
    1. catch sampled for length/age in all areas?
    
    1. effective sample size for biological samples?
]

---
## External Resources

* [Atlantis Model Documentation](https://github.com/Atlantis-Ecosystem-Model/Atlantis_example_and_instructions)

* [atlantisom R package](https://github.com/r4atlantis/atlantisom)

* [Testing atlantisom](https://github.com/sgaichas/poseidon-dev)

* Slides available at https://noaa-edab.github.io/presentations

---

background-image: url("EDAB_images/IMG_2733.jpg")
background-size: cover

## Questions?


# Tusen Takk til Havforskningsinstituttet!