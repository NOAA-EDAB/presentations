---
title: "Ecosystem modelling approaches:"
subtitle: "What questions can we address?"
author: "Sarah Gaichas, Sean Lucey, and Gavin Fay <br /> Northeast Fisheries Science Center and University of Massachusetts Dartmouth"
output:
  xaringan::moon_reader:
    css: ["default", "libs/EDAB_theme2.css"]
    lib_dir: libs
    nature:
      titleSlideClass: ["right", "middle", "my-title"]
      highlightStyle: githubp
      highlightLines: true
      countIncrementalSlides: false
  revealjs::revealjs_presentation:
    self_contained: false
    reveal_plugins: ["notes", "search"]
---
class: top, left

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = F,
                      warning = F,
                      message = F)
#Plotting and data libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(here)
library(kableExtra)
library(ggrepel)
library(stringr)

library(atlantisom)

data.dir <- here::here("data")

```

# What is an ecosystem model?

![ecomods](EDAB_images/ecomods.png)

---

# Why build one?

.pull-left[


]

.pull-right[
*Climate-Ready Management*
![Climateready](EDAB_images/KarpetalFig1.png)


]



???
---
# Suggestion:

1. Clearly specified questions/objectives
2. Data availability
3. THEN build a model, or better, model(s)

---
# Today's objective

Primary: Think about *your* research question
What data do you have to address it?
Would a model be useful to address your research question?
If so, what would you want it to do? 
Advanced: How might you build it?

Secondary: Understand what a food web model is
Know what questions to ask about how it was built
Play with a food web model
Perturb it in different ways
What do you observe?
Why might this be? (including model limitations)

---
## What is a food web model?

.pull-left[
A system of linear equations

For each group, $i$, specify: 

   Biomass $B$ [or Ecotrophic Efficiency $EE$ ]  
   Population growth rate $\frac{P}{B}$  
   Consumption rate $\frac{Q}{B}$  
   Diet composition $DC$  
   Fishery catch $C$  
   Biomass accumulation $BA$  
   Im/emigration $IM$ and $EM$  
   
Solving for $EE$ [or $B$ ] for each group:
]

.pull-right[
![toyfoodweb](EDAB_images/toyfw.png)
]

$$B_i\Big(\frac{P}{B}\Big)_i*EE_i+IM_i+BA_i=\sum_{j}\Big[ B_j\Big (\frac{Q}{B}\Big)_j*DC_{ij}\Big ]+EM_i+C_i$$
???
Mathematically identical to an "input-output" model in economics

---
## How do you build one?

OBSERVATIONS! 


---
## The Gulf of Maine food web model
![GOM food web](EDAB_images/GOMfw.png)

---

## Project overview
.pull-left[
1. Scenarios for effects of temperature on growth, natural mortality

1. Focus on key stocks (Northeast Arctic cod, Norwegian spring spawning herring, California Current sardine, Pacific hake or a Pacific rockfish)

1. Atlantis output &rarr; dataset generator (`atlantisom`) &rarr; Stock Synthesis assessment 

1. Compare performance of different model settings, multiple models, model ensembles 
]

.pull-right[
```{r nes-comp2, echo = F, fig.align = "center", fig.show = "hold"}
knitr::include_graphics("EDAB_images/CCAclimatescenario.png")
```
]
Bonus: `atlantisom` &rarr; multispecies, other single species models for testing

???


---
## Full disclosure!

.pull-left[
Still working on:

1. Estimating total mortality to back out M

1. Splitting aggregate age groups into true ages (not needed for NOBA)

1. Interpolating aggregate age groups weight at age for true ages

1. Fishery catch weight by area

1. Generalizing for different Atlantis codebase vintages
]

.pull-right[
![workinprogress scale 100%](EDAB_images/work-in-progress.png)
]


---
## Specify uncertainty in assessment "data": REDUS to the rescue!

What level of uncertainty is appropriate to carry through these analyses?
.pull-left[
1. Biological:

    1. appropriate sigma-R?

1. Survey specification:

    1. timing and spatial coverage?

    1. which species are captured?

    1. species-specific survey efficiency ("q")?

    1. selectivity at age for each species?

] 
.pull-right[
1. Survey uncertainty:

    1. additional observation error (survey cv for index)?
    
    1. effective sample size for biological samples?
    
1. Fishery uncertainty:
    
    1. additional observation error (catch cv for total)?
    
    1. catch sampled for length/age in all areas?
    
    1. effective sample size for biological samples?
]

---
## External Resources

* [Atlantis Model Documentation](https://github.com/Atlantis-Ecosystem-Model/Atlantis_example_and_instructions)

* [atlantisom R package](https://github.com/r4atlantis/atlantisom)

* [Testing atlantisom](https://github.com/sgaichas/poseidon-dev)

* Slides available at https://noaa-edab.github.io/presentations

---

background-image: url("EDAB_images/IMG_2733.jpg")
background-size: cover

## Questions?


# Tusen Takk til Havforskningsinstituttet!